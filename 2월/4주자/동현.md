# VPC 정리

VPC는 Virtual Private Cloud의 약자인데, 쉽게 말해 가상의 네트워크를 만들어 준다고 생각하면 쉽다.

EC2인스턴스와 같은 다양한 AWS서비스들의 구조를 명확히 하기 위해 나온 서비스로 여러가지 기능을 통해 내 입맛대로 구축할수 있게 해준다. 

<img width="448" alt="스크린샷 2023-03-02 오후 12 06 03" src="https://user-images.githubusercontent.com/81304010/222407463-76aaf256-6de5-4b4e-b99f-e3b3aa074f1d.png">


위에 아키텍쳐를 기반으로 VPC를 한번 생성하면서 감을 잡아보자

<img width="1678" alt="스크린샷 2023-03-02 오후 12 27 21" src="https://user-images.githubusercontent.com/81304010/222407565-16319922-f529-4b1e-81e9-1b42005683ec.png">

<img width="482" alt="스크린샷 2023-03-02 오후 2 05 06" src="https://user-images.githubusercontent.com/81304010/222407753-6f095dde-63ec-4bfd-91a7-5a5a28dd781e.png">

- CIDR은 그냥 쉽게 말해 VPC가 어떤 IP대역을 사용할건지를 말하는 것으로, 본인은 10.0.0.0/16대역을 이용하여 뒤에 0.0부분을 가용영역으로 사용하였다.
- ipv6는 자신이 변태가 아니라면 사용하지 않도록 하자.
- 테넌시는 비유를 들자면 병원에서 6인실을 쓸거냐, 1인실을 쓸거냐와 같은데, VPC가 공유되는 하드웨어 저장소에서 실행될지, 독립적인 하드웨어 저장소에서 실행될건지를 정하는 옵션이다.
- 가용영역은 물리적으로 떨어져있는 데이터센터를 의미합니다. 각 가용영역간에는 독립적인 전원과 물리적 보안이 적용되어 화산폭발, 운석충돌,방화등 각종 재난과 사고로 인해 하나의 가용영역이 멈춰도 다른 가용영역이 정상적으로 동작할 수 있게, 2개이상의 가용영역을 구성하는데 좋다.
- 퍼블릭 서브넷은 제약없이 외부와 직접적인 통신이 가능한 네트워크이다. 프라이빗 서브넷은 기본적으로는 외부와의 통신이 불가능하고, NAT gateway를 이용해서 내부→외부로만 제한적인 통신이 가능하다.
- 세부정보를 통해 각 서브넷의 IP대역을 지정해줄 수 있는데, 본인은 기본으로 지정해줬다.

> 퀴즈: ap-northeast-2b의 가용영역의 범위는 얼마나 될까용?(5점)
> 
- NAT 게이트웨이는 위에서 설명했다시피 프라이빗 서브넷이 통신할 때 사용하는 서비스인데, 아키텍쳐상에는 az당 한개의 게이트웨이를 적용했기에 2개 해보도록 하겠다 (겁나 비싸다)
- 마지막 엔드포인트는 rds,ec2같이 VPC내부에서 실행되는 서비스에서 VPC외부에 있는 aws리소스를 참조할 때 따로 전용 엔드포인트를 사용함으로 써 NAT gateway요금을 줄일 수 있는 서비스이다.

---

만드는 법을 알았으니 이제 이론을 파헤쳐 보자.

### IG (Internat Gateway)

사실 그냥 라우터가 하는일 중 하나인 공인 IP를 받아서 내부 LAN과 연결해주는 서비스이다. 

기본적으로 내부의 리소스가 인터넷에 연결되게 해주고, 외부에서 내부의 리소스에 접근할 수 있게 해준다.

### Route Table

이건 애초에 라우터에 있는 서비스이다. 트래픽이 가야할 경로를 지정해준다.

### NACL(Network Access Control List)

가상의 방화벽이라는 점에서 보안그룹과 비슷하지만 보안그룹은 인스턴스 단위에서 트래픽 필터링을 수행하지만, 

NACL은 서브넷 단위에서 필터링을 수행하기에 좀더 포괄적인 필터링이 가능하다.

### Bastion Host

배스쳔 호스트(왜 이렇게 읽는지 모르겠음)는 프라이빗 서브넷과 통신하기위해 만들어진 개념으로 퍼블릭 서브넷에 배스쳔 호스트를 두고 그 호스트에 접속해서 프라이빗 서브넷에 있는 리소스에 접근할 수 있다

### Transit Gateway

vpc peering처럼 서로 다른 VPC간의 통신이 가능하도록 해주는 서비스이다. 하지만 VPC의 1ㄷ1연결만을 지원하는 peering과 달리 허브처럼 복수의 VPC연결을 관리할 수 있고, 온 프레미스 환경과도 연결할 수 있다.
